<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">

    <style>
        .jumbotron {
            margin: 50px;
        }
    </style>
</head>

<body>
    <div style="padding: 0 300px" class="container">
        <div class="jumbotron">
            <div class="row">
                <div class="col-xs-12">
                    <div class="text-center">
                        <h2>Currency Converter</h2>
                    </div>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-xs-12">
                    <div class="form-group">
                        <label for="">Amount:</label>
                        <input id="quantity" class="form-control" type="number">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <div class="form-group">
                        <label id="origin-currency" for="">from:</label>
                        <select class="form-control" name="" id="origin-currency-sel">
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <div class="form-group">
                        <label id="desteny-currency" for="">to:</label>
                        <select class="form-control" name="" id="desteny-currency-sel">
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <button id="btn-convert" class="btn btn-primary">Converter</button>
                </div>
            </div>
            <label for="">Result:</label>
            <p id="result"></p>
        </div>
    </div>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js', { scope: '/' })
                .then(function (reg) {
                    // registration worked
                    console.log('Registration succeeded. Scope is ' + reg.scope);
                }).catch(function (error) {
                    // registration failed
                    console.log('Registration failed with ' + error);
                });
        }
    </script>

    <!-- API Calls -->
    <script>
        // ---------- get all countries 
        fetch('https://free.currencyconverterapi.com/api/v5/countries').then(response => response.json()).then(
            response => {
            });
        // ---------- get all currencies 
        fetch('https://free.currencyconverterapi.com/api/v5/currencies').then(response => response.json()).then(
            response => {
                const originSelect = document.getElementById('origin-currency-sel');
                const destenySelect = document.getElementById('desteny-currency-sel');
                const allCourency = Object.entries(response.results);
                allCourency.map(item => {
                    var option = document.createElement("option");
                    if (item[1].currencySymbol)
                        option.text = `${item[1].currencyName} ${item[1].currencySymbol}`;
                    else
                        option.text = `${item[1].currencyName}`;
                    option.value = item[1].id;
                    originSelect.appendChild(option);
                });
                allCourency.map(item => {
                    var option = document.createElement("option");
                    if (item[1].currencySymbol)
                        option.text = `${item[1].currencyName} ${item[1].currencySymbol}`;
                    else
                        option.text = `${item[1].currencyName}`;
                    option.value = item[1].id;
                    destenySelect.appendChild(option);
                });
            });
        const btnConvert = document.getElementById('btn-convert');
        btnConvert.addEventListener('click', () => {
            const source = document.getElementById('origin-currency-sel');
            const sourceVal = source.options[source.selectedIndex].value;
            const target = document.getElementById('desteny-currency-sel');
            const targetVal = target.options[target.selectedIndex].value;
            // ---------- get  compact currency 
            fetch(`https://free.currencyconverterapi.com/api/v5/convert?q=${sourceVal}_${targetVal}&compact=y`).then(response => response.json()).then(
                response => {
                    const quantity = document.getElementById('quantity');
                    const tax = Object.entries(response);
                    let result = 0;
                    tax.map(item => {
                        result = Number(quantity.value) * item[1].val;
                    })
                    document.getElementById('result').innerHTML = result;
                });
        });
    </script>

    <!-- libraries importations-->

    <!-- Jquery Library -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
</body>

</html>